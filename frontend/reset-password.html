<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reset Password</title>
    <link rel="stylesheet" href="css/reset-password.css" />
  </head>
  <body>
    <div class="page-wrapper">
      <header>
        <div class="nav-left">
       <a href="index.html"><h1> ðŸš‘ ResQNow </h1></a>
 
        </div>
        <nav class="nav-right">
          <a href="index.html">Home</a>
          <span class="phone-number">Need Help :- ðŸ“ž 1800-234-001</span>
        </nav>
      </header>

      <main class="main-content">
        <div class="reset-container">
          <h2>Reset Your Password</h2>
          <form id="resetPasswordForm">
            <input
              type="text"
              id="otp"
              placeholder="Enter Reset Code (shown on previous page)"
              required
            />
            <input
              type="password"
              id="newPassword"
              placeholder="New Password"
              required
            />
            <input
              type="password"
              id="confirmPassword"
              placeholder="Confirm Password"
              required
            />
            <button type="submit">Reset Password</button>
          </form>
          <p id="resetMessage"></p>
        </div>
      </main>

      <footer>&copy; 2025 ResQNow. All rights reserved.</footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="js/config.js"></script>
    <script>
      document
        .getElementById("resetPasswordForm")
        .addEventListener("submit", async function (e) {
          e.preventDefault();
          const email = localStorage.getItem("resetEmail");
          const enteredOTP = document.getElementById("otp").value;
          
          // Note: We're not verifying the OTP on the client side anymore
          // The server will handle the reset without OTP verification
          const newPassword = document.getElementById("newPassword").value;
          const confirmPassword =
            document.getElementById("confirmPassword").value;

          if (newPassword !== confirmPassword) {
            document.getElementById("resetMessage").innerText =
              "Passwords do not match.";
            return;
          }

          try {
            const response = await axios.post(
              `${API_BASE_URL}/auth/reset-password`,
              { email, newPassword }
            );
            document.getElementById("resetMessage").innerText =
              response.data.msg;
            
            // Clear the stored email after successful reset
            localStorage.removeItem("resetEmail");
            
            // Redirect to login page after a short delay
            setTimeout(() => {
              window.location.href = "login.html";
            }, 2000);
          } catch (error) {
            document.getElementById("resetMessage").innerText =
              error.response?.data?.msg || "Something went wrong";
          }
        });
    </script>
  </body>
</html>
